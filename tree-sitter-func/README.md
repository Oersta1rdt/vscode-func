# tree-sitter-func
FunC grammar for [tree-sitter](https://github.com/tree-sitter/tree-sitter).

Copied from https://github.com/akifoq/tree-sitter-func to continue developing here (that repo is abandoned).

## How to update and test grammar

You should update `grammar.js` and/or `grammar/` folder (required from js).  
Folders `src`, `bindings`, `build`, and files `binding.gyp`, `Cargo.toml` are auto-generated by tree-sitter.  

After updating grammar, run
```bash
tree-sitter generate
```
(will change `src/`).

To manually test, create `tmp.fc` with some content, and run
```bash
tree-sitter parse tmp.fc
```
and manually inspect the output.

If you introduce new keywords, also modify `queries/highlights.scm`.  
This file is not needed for VS Code, but
```bash
tree-sitter highlight tmp.fc
```
produces colored output, just a pleasant feature, so keep this file up to date also.

Note, that for VS Code highlighting, besides grammar, you will probably have to touch
[.tmLanguage.json](../syntaxes/.tmLanguage.json).

Finally, to build wasm, run **in the project folder**
```bash
yarn grammar:compile
```
This is executed in Docker and takes a long time.
After ~5 minutes, `tree-sitter-func.wasm` will be saved into the `server/` folder.

Don't forget to run/update JS tests in `server/src/parsing.spec.ts` after modifying grammar! 

## How to test the plugin in VS Code locally

After modifying grammar or changing sources of the plugin, run **in the project folder**:
```bash
yarn vscode:prepublish
```
This will make the `dist/` folder. 

The easiest way to launch an extension is from VS Code (even if you write code in IntelliJ :)).
Open this project, in *"Run and Debug"* just *"Launch Extension"*. 
Debugging works by the way, both for a client-side (automatically) and for a server-side (choose *"Attach"*).
